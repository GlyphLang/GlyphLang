# E-Commerce API Example
# Demonstrates: Products, cart, orders, inventory

# =================
# Health Check
# =================

@ GET /health
  > {status: "ok", service: "E-Commerce API"}

# =================
# Products
# =================

@ GET /products
  $ page: int = 1
  $ limit: int = 20
  $ category: string = ""
  $ min_price: int = 0
  $ max_price: int = 999999

  $ products = [
    {
      :id = 1,
      :name = "Laptop Pro 15",
      :slug = "laptop-pro-15",
      :description = "High-performance laptop with 16GB RAM and 512GB SSD",
      :price = 1299.99,
      :sale_price = 1099.99,
      :category = "Electronics",
      :brand = "TechBrand",
      :sku = "LTP-PRO-15",
      :stock = 45,
      :images = ["laptop1.jpg", "laptop2.jpg"],
      :rating = 4.5,
      :reviews_count = 128,
      :tags = ["laptop", "computer", "electronics"],
      :featured = true,
      :on_sale = true
    },
    {
      :id = 2,
      :name = "Wireless Mouse",
      :slug = "wireless-mouse",
      :description = "Ergonomic wireless mouse with precision tracking",
      :price = 29.99,
      :sale_price = 0,
      :category = "Electronics",
      :brand = "PeripheralCo",
      :sku = "WMS-001",
      :stock = 234,
      :images = ["mouse1.jpg"],
      :rating = 4.2,
      :reviews_count = 56,
      :tags = ["mouse", "wireless", "accessories"],
      :featured = false,
      :on_sale = false
    },
    {
      :id = 3,
      :name = "Office Chair Deluxe",
      :slug = "office-chair-deluxe",
      :description = "Comfortable ergonomic office chair with lumbar support",
      :price = 249.99,
      :sale_price = 199.99,
      :category = "Furniture",
      :brand = "ComfortSeating",
      :sku = "OCH-DLX-BLK",
      :stock = 67,
      :images = ["chair1.jpg", "chair2.jpg", "chair3.jpg"],
      :rating = 4.7,
      :reviews_count = 203,
      :tags = ["chair", "furniture", "office"],
      :featured = true,
      :on_sale = true
    }
  ]

  > {
    :products = products,
    :pagination = {
      :page = page,
      :limit = limit,
      :total = 3
    }
  }

@ GET /products/:id
  $ product_id = int(id)

  $ product = {
    :id = product_id,
    :name = "Product " + id,
    :description = "Full description here",
    :price = 99.99,
    :stock = 100,
    :category = "Electronics",
    :specifications = {
      :weight = "2.5 kg",
      :dimensions = "30x20x5 cm",
      :color = "Black",
      :warranty = "1 year"
    },
    :reviews = [
      {:author = "John", :rating = 5, :comment = "Great product!"},
      {:author = "Jane", :rating = 4, :comment = "Good value"}
    ]
  }

  > {product: product}

@ POST /products
  $ name: string
  $ description: string
  $ price: float
  $ category: string
  $ stock: int
  $ sku: string

  ? validate_length(name, 3, 200)
  ? validate_length(description, 10, 5000)
  ? validate_range(price, 0.01, 999999.99)
  ? validate_range(stock, 0, 999999)
  ? scan_xss(name)
  ? scan_xss(description)

  $ new_product = {
    :id = 123,
    :name = name,
    :description = description,
    :price = price,
    :category = category,
    :stock = stock,
    :sku = sku,
    :created_at = timestamp()
  }

  > {
    :message = "Product created",
    :product = new_product
  }

# =================
# Shopping Cart
# =================

@ GET /cart/:userId
  $ user_id = int(userId)

  $ cart = {
    :user_id = user_id,
    :items = [
      {
        :product_id = 1,
        :name = "Laptop Pro 15",
        :quantity = 1,
        :price = 1099.99,
        :subtotal = 1099.99
      },
      {
        :product_id = 2,
        :name = "Wireless Mouse",
        :quantity = 2,
        :price = 29.99,
        :subtotal = 59.98
      }
    ],
    :subtotal = 1159.97,
    :tax = 92.80,
    :shipping = 0,
    :total = 1252.77
  }

  > {cart: cart}

@ POST /cart/:userId/items
  $ user_id = int(userId)
  $ product_id: int
  $ quantity: int

  ? validate_range(product_id, 1, 999999)
  ? validate_range(quantity, 1, 100)

  > {
    :message = "Item added to cart",
    :user_id = user_id,
    :product_id = product_id,
    :quantity = quantity
  }

@ PUT /cart/:userId/items/:productId
  $ user_id = int(userId)
  $ product_id = int(productId)
  $ quantity: int

  ? validate_range(quantity, 0, 100)

  > {
    :message = "Cart updated",
    :product_id = product_id,
    :quantity = quantity
  }

@ DELETE /cart/:userId/items/:productId
  $ user_id = int(userId)
  $ product_id = int(productId)

  > {
    :message = "Item removed from cart",
    :product_id = product_id
  }

@ POST /cart/:userId/clear
  $ user_id = int(userId)

  > {
    :message = "Cart cleared",
    :user_id = user_id
  }

# =================
# Orders
# =================

@ POST /orders
  $ user_id: int
  $ shipping_address: object
  $ payment_method: string
  $ items: array

  $ order = {
    :id = "ORD-" + timestamp(),
    :user_id = user_id,
    :status = "pending",
    :items = items,
    :subtotal = 1159.97,
    :tax = 92.80,
    :shipping = 0,
    :total = 1252.77,
    :payment_method = payment_method,
    :shipping_address = shipping_address,
    :created_at = timestamp()
  }

  > {
    :message = "Order created",
    :order = order
  }

@ GET /orders/:id
  $ order_id = id

  $ order = {
    :id = order_id,
    :user_id = 1,
    :status = "shipped",
    :tracking_number = "TRK123456789",
    :items = [
      {:product_id = 1, :name = "Laptop Pro 15", :quantity = 1, :price = 1099.99}
    ],
    :total = 1252.77,
    :created_at = "2025-01-01T10:00:00Z",
    :updated_at = "2025-01-02T14:30:00Z"
  }

  > {order: order}

@ PUT /orders/:id/status
  $ order_id = id
  $ status: string

  > {
    :message = "Order status updated",
    :order_id = order_id,
    :status = status,
    :updated_at = timestamp()
  }

# =================
# Reviews
# =================

@ GET /products/:productId/reviews
  $ product_id = int(productId)

  $ reviews = [
    {
      :id = 1,
      :product_id = product_id,
      :author = "John Doe",
      :rating = 5,
      :title = "Excellent product!",
      :comment = "Very satisfied with this purchase",
      :verified_purchase = true,
      :helpful_count = 12,
      :created_at = "2025-01-01T10:00:00Z"
    }
  ]

  > {
    :product_id = product_id,
    :reviews = reviews,
    :average_rating = 4.5,
    :total_reviews = 1
  }

@ POST /products/:productId/reviews
  $ product_id = int(productId)
  $ user_id: int
  $ rating: int
  $ title: string
  $ comment: string

  ? validate_range(rating, 1, 5)
  ? validate_length(title, 3, 100)
  ? validate_length(comment, 10, 2000)
  ? scan_xss(title)
  ? scan_xss(comment)

  $ review = {
    :id = 123,
    :product_id = product_id,
    :user_id = user_id,
    :rating = rating,
    :title = title,
    :comment = comment,
    :created_at = timestamp()
  }

  > {
    :message = "Review submitted",
    :review = review
  }

# =================
# Categories
# =================

@ GET /categories
  $ categories = [
    {:id = 1, :name = "Electronics", :slug = "electronics", :count = 145},
    {:id = 2, :name = "Furniture", :slug = "furniture", :count = 67},
    {:id = 3, :name = "Clothing", :slug = "clothing", :count = 234}
  ]

  > {categories: categories}

# =================
# Wishlist
# =================

@ GET /wishlist/:userId
  $ user_id = int(userId)

  $ items = [
    {:product_id = 5, :name = "Monitor 4K", :price = 399.99, :added_at = "2025-01-01T10:00:00Z"}
  ]

  > {
    :user_id = user_id,
    :items = items,
    :count = 1
  }

@ POST /wishlist/:userId
  $ user_id = int(userId)
  $ product_id: int

  > {
    :message = "Added to wishlist",
    :user_id = user_id,
    :product_id = product_id
  }
