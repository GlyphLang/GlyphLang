# Intent Test: Real-time chat server with WebSocket, rooms, and message history

: Message {
  id: str!
  room: str!
  sender: str!
  content: str!
  timestamp: int!
}

: Room {
  id: str!
  name: str!
  created_by: str!
  created_at: int!
}

: CreateRoomInput {
  name: str!
}

# REST endpoints for room management
@ POST /api/rooms {
  + auth(jwt)
  < input: CreateRoomInput
  % db: Database
  $ room = db.rooms.Create({
    id: generateId(),
    name: input.name,
    created_by: auth.user.id,
    created_at: now()
  })
  > room
}

@ GET /api/rooms {
  + auth(jwt)
  % db: Database
  $ rooms = db.rooms.Find()
  > rooms
}

@ GET /api/rooms/:room_id/messages {
  + auth(jwt)
  % db: Database
  $ messages = db.messages.Where({room: room_id})
  > messages
}

# WebSocket for real-time messaging
@ ws /chat {
  on connect {
    ws.broadcast("User joined the chat")
  }

  on message {
    ws.broadcast(input)
  }

  on disconnect {
    ws.broadcast("User left the chat")
  }
}
